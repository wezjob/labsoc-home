# =============================================================================
# Grafana OAuth2 Configuration for Keycloak SSO
# =============================================================================
# Add these environment variables to Grafana in docker-compose.yml
# Replace CLIENT_SECRET with the actual secret from Keycloak
# =============================================================================

# Basic OAuth Settings
GF_AUTH_GENERIC_OAUTH_ENABLED=true
GF_AUTH_GENERIC_OAUTH_NAME=Keycloak
GF_AUTH_GENERIC_OAUTH_ALLOW_SIGN_UP=true
GF_AUTH_GENERIC_OAUTH_AUTO_LOGIN=false

# Keycloak Client Configuration
GF_AUTH_GENERIC_OAUTH_CLIENT_ID=grafana
GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET=${KEYCLOAK_GRAFANA_SECRET}

# OIDC Endpoints
GF_AUTH_GENERIC_OAUTH_SCOPES=openid email profile roles
GF_AUTH_GENERIC_OAUTH_AUTH_URL=http://host.docker.internal:8180/realms/soc-in-a-box/protocol/openid-connect/auth
GF_AUTH_GENERIC_OAUTH_TOKEN_URL=http://host.docker.internal:8180/realms/soc-in-a-box/protocol/openid-connect/token
GF_AUTH_GENERIC_OAUTH_API_URL=http://host.docker.internal:8180/realms/soc-in-a-box/protocol/openid-connect/userinfo

# User attribute mapping
GF_AUTH_GENERIC_OAUTH_EMAIL_ATTRIBUTE_PATH=email
GF_AUTH_GENERIC_OAUTH_LOGIN_ATTRIBUTE_PATH=preferred_username
GF_AUTH_GENERIC_OAUTH_NAME_ATTRIBUTE_PATH=name

# Role mapping from Keycloak roles
GF_AUTH_GENERIC_OAUTH_ROLE_ATTRIBUTE_PATH=contains(roles[*], 'soc-admin') && 'Admin' || contains(roles[*], 'soc-analyst') && 'Editor' || 'Viewer'

# Security settings
GF_AUTH_GENERIC_OAUTH_TLS_SKIP_VERIFY_INSECURE=true
GF_AUTH_GENERIC_OAUTH_USE_PKCE=true
